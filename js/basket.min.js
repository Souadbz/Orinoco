let panier=JSON.parse(localStorage.getItem("cart"));const allProductsBasket=document.getElementById("container-products-basket");let productsBasket=document.getElementById("productsBasket");function getPanier(){if(null==panier||0===panier.length){const basketEmpty='<div>\n        <p class="basket-empty"> Votre panier est vide </p>\n    </div>';allProductsBasket.innerHTML=basketEmpty}else{let produitsPanier=[];console.log(panier),panier.forEach(teddy=>{productsBasket.innerHTML+=`<tr>  \n        <td>${teddy.name}</td>   \n        <td>${teddy.quantity}</td>\n        <td id="price">${teddy.price/100}.00€</td>        \n        <td id="colors">${teddy.colors}</td>\n        <td><button id="btn-supprimer">supprimer</button></td>\n        <td id="total">${teddy.quantity*teddy.price/100}.00€</td>\n        </tr> `;for(let i=0;i<panier.length;i++)produitsPanier.push(teddy)})}}function btnSupprimer(){let buttonSupprimer=document.querySelectorAll("#btn-supprimer");for(let j=0;j<buttonSupprimer.length;j++)buttonSupprimer[j].addEventListener("click",event=>{event.preventDefault();let idButtonSupprimer=panier[j].colors;console.log(idButtonSupprimer),panier=panier.filter(element=>element.colors!==idButtonSupprimer),localStorage.setItem("cart",JSON.stringify(panier)),window.location.href="basket.html"})}function prixPanier(){let prixTotal=[];for(let k=0;k<panier.length;k++){let prixProduitsBasket=panier[k].price/100*panier[k].quantity;prixTotal.push(prixProduitsBasket)}const reducer=(accumulator,currentValue)=>accumulator+currentValue,totalCalcul=prixTotal.reduce(reducer,0),affichagePrixFinal=`<div id='prix-final'>\n       Montant total : ${totalCalcul}.00€\n        </div>`;productsBasket.insertAdjacentHTML("beforeend",affichagePrixFinal),localStorage.setItem("prixTotal",JSON.stringify(totalCalcul))}function viderPanier(){let viderBasket;function deleteBasket(){null==panier||(allProductsBasket.remove(),localStorage.clear(),window.location.reload())}document.getElementById("viderBasket").addEventListener("click",deleteBasket)}getPanier(),btnSupprimer(),prixPanier(),viderPanier();const monTextAlert=values=>`${values}: Les chiffres et les symboles ne sont pas autorisés. Minimum 3 caractéres et Maximum 20 caractères`;function regExPrenomNomVille(value){return/^([A-Za-z]{3,20})?([-]{0,1})?([A-Za-z\s]{3,20})$/.test(value)}function regExEmail(value){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(value)}function regExAdresse(value){return/^[A-Za-z-0-9\s]{10,50}$/.test(value)}const lePrenom=document.getElementById("firstName");lePrenom.addEventListener("change",(function(e){return!!regExPrenomNomVille(lePrenom.value)||(alert(monTextAlert("Prénom")),!1)}));const leNom=document.getElementById("lastName");leNom.addEventListener("change",(function(e){return!!regExPrenomNomVille(leNom.value)||(alert(monTextAlert("Nom")),!1)}));const leEmail=document.getElementById("inputEmail4");leEmail.addEventListener("change",(function(e){return!!regExEmail(leEmail.value)||(alert("l'email n'est pas valide"),!1)}));const lAdresse=document.getElementById("inputAddress");lAdresse.addEventListener("change",(function(e){return!!regExAdresse(lAdresse.value)||(alert("l'adresse doit contenir que des chiffres et des lettres sans ponctuation"),!1)}));const laVille=document.getElementById("inputCity");laVille.addEventListener("change",(function(e){return!!regExPrenomNomVille(laVille.value)||(alert(monTextAlert("Ville")),!1)}));let products=[];for(teddy of panier){const productsId=teddy.id;products.push(productsId)}localStorage.setItem("products",JSON.stringify(products));const btnValiderMaCommande=document.getElementById("validerMaCommande");btnValiderMaCommande.addEventListener("click",event=>{event.preventDefault();let contact={firstName:lePrenom.value,lastName:leNom.value,address:lAdresse.value,city:laVille.value,email:leEmail.value};regExPrenomNomVille(lePrenom.value)&&regExPrenomNomVille(leNom.value)&&regExEmail(leEmail.value)&&regExAdresse(lAdresse.value)&&regExPrenomNomVille(laVille.value)?localStorage.setItem("contact",JSON.stringify(contact)):alert("Veuillez bien remplir le formulaire");let commandeClient=JSON.stringify({products:products,contact:contact});function order(){let sendOrder;fetch("http://localhost:3000/api/teddies/order",{method:"POST",body:commandeClient,headers:{Accept:"application/json","content-type":"application/json"}}).then(async response=>{try{const contenu=await response.json();console.log(contenu),response.ok?(console.log(contenu.orderId),localStorage.setItem("commande",contenu.orderId),window.location.href="confirmation.html"):console.log("problème avec le serveur")}catch(error){console.log("commande non envoyer, merci de bien remplir le formulaire ")}})}console.log(commandeClient),order()});